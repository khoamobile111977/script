local lp = game.Players.LocalPlayer
game:GetService("Players").LocalPlayer.Idled:connect(function()
	game:GetService("VirtualUser"):Button2Down(Vector2.new(0,0),workspace.CurrentCamera.CFrame)
	wait(1)
	game:GetService("VirtualUser"):Button2Up(Vector2.new(0,0),workspace.CurrentCamera.CFrame)
end)

local id = game.PlaceId
if id == 2753915549 then First_Sea = true; elseif id == 4442272183 then Second_Sea = true; elseif id == 7449423635 then Third_Sea = true; else game.Players.LocalPlayer:Kick("Hỗ trợ BloxKid thôi nha!") end;

First_Sea = false
Second_Sea = false
Third_Sea = false
local placeId = game.PlaceId
if placeId == 2753915549 then
	First_Sea = true
elseif placeId == 4442272183 then
	Second_Sea = true
elseif placeId == 7449423635 then
	Third_Sea = true
end

local autoChestEnabled = false

if First_Sea then
    local ScreenGui = Instance.new("ScreenGui")
    local ToggleButton = Instance.new("TextButton")

    ScreenGui.Parent = game:GetService("Players").LocalPlayer:WaitForChild("PlayerGui")
    ScreenGui.Name = "AutoChestGui"

    ToggleButton.Parent = ScreenGui
    ToggleButton.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    ToggleButton.Position = UDim2.new(0.5, -50, 0.5, -25)
    ToggleButton.Size = UDim2.new(0, 100, 0, 50)
    ToggleButton.Font = Enum.Font.SourceSans
    ToggleButton.Text = "Auto Chest: OFF"
    ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    ToggleButton.TextSize = 14

    ToggleButton.MouseButton1Click:Connect(function()
        autoChestEnabled = not autoChestEnabled
        ToggleButton.Text = "Auto Chest: " .. (autoChestEnabled and "ON" or "OFF")
        if autoChestEnabled then
            mainLoop()
        end
    end)
end

local areas = {
    "Colosseum", "Desert", "Fountain", "Magma", "MobBoss", "Pirate",
    "Prison", "Sky", "SkyArea1", "SkyArea2", "Town"
}

local function resetCharacter()
    if lp.Character then
        lp.Character:BreakJoints()  -- Reset nhân vật
        task.wait(3)  -- Chờ 2 giây để tránh lỗi nhân vật chưa tải xong
    end
end

local function jumpCharacter()
    if lp.Character and lp.Character:FindFirstChild("Humanoid") then
        lp.Character.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
    end
end

local function teleportToChest(area, index)
    local chestPath = workspace.Map:FindFirstChild(area)
    if chestPath then
        local chests = chestPath:FindFirstChild("Chests")
        if chests then
            local allChests = chests:GetChildren()
            if index <= #allChests then
                local targetChest = allChests[index]
                if targetChest and targetChest:IsA("BasePart") then
                    if lp.Character and lp.Character:FindFirstChild("HumanoidRootPart") then
                        lp.Character.HumanoidRootPart.CFrame = targetChest.CFrame
                        jumpCharacter()  -- Nhảy sau khi dịch chuyển
                    end
                end
            end
        end
    end
end

local function hopServer()
    -- Logic để chuyển server
    game:GetService("TeleportService"):Teleport(game.PlaceId)
end

local function mainLoop()
    local count = 0
    local resetCount = 0
    while autoChestEnabled do
        for _, area in ipairs(areas) do
            for index = 1, 7 do
                teleportToChest(area, index)
                count = count + 1
                task.wait(0.2)  -- Thời gian dịch chuyển giữa các chest là 0.25s
                if count % 70 == 0 then  -- Reset nhân vật sau mỗi 100 lần dịch chuyển 
                    resetCharacter()
                    resetCount = resetCount + 1
                end
                if resetCount >= 6 then  -- Auto hop server sau khi reset nhân vật 10 lần
                    hopServer()
                    return
                end
            end
        end
    end
end

-- Remove the immediate call to mainLoop
-- mainLoop()
