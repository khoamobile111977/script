-- function.lua
local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local Window = Fluent:CreateWindow({ Title = "Auto Rip Indra Farm", SubTitle = "by Khoa" })
local MainTab = Window:AddTab({ Title = "Elite Hunter", Icon = "🗡️" })

local Enabled = false
MainTab:AddToggle("EnableAutoIndra", { Title = "Auto Summon Rip Indra", Default = false }, function(state)
    Enabled = state
end)

-- Fast Attack (UltraFastAttack)
local UltraFastAttack = {}
local plr = game:GetService("Players").LocalPlayer
local rs = game:GetService("ReplicatedStorage")
local attackActive = true
local lastTick = 0

local function GetValidTargets()
    local targets = {}
    local char = plr.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return targets end
    
    local origin = char.HumanoidRootPart.Position
    local bodyParts = {"HumanoidRootPart", "Head", "UpperTorso", "LowerTorso"}
    

    for _, target in ipairs(workspace.Enemies:GetChildren()) do
        if target:FindFirstChild("Humanoid") and target.Humanoid.Health > 0 then
            local tRoot = target:FindFirstChild("HumanoidRootPart")
            if tRoot and (tRoot.Position - origin).Magnitude < 50 then
                table.insert(targets, {
                    model = target,
                    part = target:FindFirstChild(bodyParts[math.random(1, #bodyParts)]) or tRoot
                })
            end
        end
    end
    

    for _, player in ipairs(game.Players:GetPlayers()) do
        if player ~= plr and player.Character then
            local character = player.Character
            if character:FindFirstChild("Humanoid") and character.Humanoid.Health > 0 then
                local tRoot = character:FindFirstChild("HumanoidRootPart")
                if tRoot and (tRoot.Position - origin).Magnitude < 50 then
                    table.insert(targets, {
                        model = character,
                        part = character:FindFirstChild(bodyParts[math.random(1, #bodyParts)]) or tRoot
                    })
                end
            end
        end
    end
    
    return targets
end

local function ExecuteAttack()
    if tick() - lastTick < 0.05 then return end 
    lastTick = tick()
    
    local char = plr.Character
    if not char or not char:FindFirstChildOfClass("Tool") then return end
    
    local targets = GetValidTargets()
    if #targets == 0 then return end
    local modules = rs:FindFirstChild("Modules")
    if not modules then return end
    
    local net = modules:FindFirstChild("Net")
    if not net then return end
    
    local registerAttack = net:FindFirstChild("RE/RegisterAttack")
    local registerHit = net:FindFirstChild("RE/RegisterHit")
    if registerAttack then
        registerAttack:FireServer(0) 
    end
    for _, target in ipairs(targets) do
        if registerHit then
            registerHit:FireServer(target.part, {{target.model, target.part}})
        end
        local combatScript = plr.PlayerScripts and plr.PlayerScripts:FindFirstChildOfClass("LocalScript")
        if combatScript and getsenv then
            local success, env = pcall(getsenv, combatScript)
            if success and env and env._G and env._G.SendHitsToServer then
                env._G.SendHitsToServer(target.part, {{target.model, target.part}})
            end
        end
        
        task.wait(0.01)
    end
end

game:GetService("RunService").Heartbeat:Connect(function()
    if attackActive then
        ExecuteAttack()
    end
end)

getgenv().ToggleFastAttack = function(state)
    attackActive = state ~= false
    return attackActive
end

getgenv().SetAttackRange = function(range)
    if type(range) == "number" then
        MAX_ATTACK_RANGE = math.clamp(range, 10, 100)
    end
end
ToggleFastAttack(true)

-- Tìm elite boss
function findElite()
    for _, enemy in pairs(workspace.Enemies:GetChildren()) do
        if enemy:FindFirstChild("Humanoid") and enemy.Humanoid.Health > 0 then
            if string.find(enemy.Name, "Deandre") or string.find(enemy.Name, "Urban") or string.find(enemy.Name, "Diablo") then
                return enemy
            end
        end
    end
end

-- Teleport
function tp(pos)
    local hrp = game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if hrp then
        hrp.CFrame = pos
    end
end

-- Tự động hop server
function hopServer()
    wait(3)
    local Http = game:GetService("HttpService")
    local Servers = Http:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/7449423635/servers/Public?sortOrder=Asc&limit=100"))
    for i, v in pairs(Servers.data) do
        if v.playing < 10 and v.id ~= game.JobId then
            game:GetService("TeleportService"):TeleportToPlaceInstance(game.PlaceId, v.id)
            break
        end
    end
end

-- Kiểm tra túi đồ có God Chalice không
function hasGodChalice()
    for _, item in pairs(game.Players.LocalPlayer.Backpack:GetChildren()) do
        if item.Name == "God's Chalice" then
            return true
        end
    end
    for _, item in pairs(game.Players.LocalPlayer.Character:GetChildren()) do
        if item.Name == "God's Chalice" then
            return true
        end
    end
    return false
end

-- Tìm nút triệu hồi Rip Indra
function touchButton()
    for _, v in pairs(workspace:GetDescendants()) do
        if v:IsA("TouchTransmitter") and v.Parent and v.Parent:IsA("Part") and v.Parent.Name == "TouchInterest" then
            firetouchinterest(game.Players.LocalPlayer.Character.HumanoidRootPart, v.Parent, 0)
            firetouchinterest(game.Players.LocalPlayer.Character.HumanoidRootPart, v.Parent, 1)
        end
    end
end

-- Vòng lặp chính
spawn(function()
    while wait(1) do
        if Enabled then
            if hasGodChalice() then
                touchButton()
                wait(2)
                game.ReplicatedStorage.Remotes.CommF_:InvokeServer("SpawnIndra")
                Enabled = false
            else
                local elite = findElite()
                if elite then
                    repeat
                        pcall(function()
                            game.Players.LocalPlayer.Character:FindFirstChildOfClass("Humanoid"):ChangeState(11)
                            tp(elite.HumanoidRootPart.CFrame * CFrame.new(0, 20, 0))
                            ToggleFastAttack(true)
                        end)
                        wait()
                    until not elite or elite.Humanoid.Health <= 0 or not Enabled
                else
                    hopServer()
                end
            end
        end
    end
end)
