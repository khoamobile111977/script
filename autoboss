-- Script chính auto kill Elite + Summon Rip Indra với Fluent UI + Fast Attack
-- File: function.lua

-- Tải UI Fluent
local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

local Window = Fluent:CreateWindow({Title = "Auto Indra Summon", SubTitle = "by Khoa", TabWidth = 160, Size = UDim2.fromOffset(500, 350), Acrylic = true})
local Tabs = { Main = Window:AddTab({Title = "Main", Icon = "axe"}) }
local Options = Fluent.Options

local AutoKillEnabled = false

Tabs.Main:AddToggle("AutoKillElite", {
    Title = "Auto Kill Elite & Summon Indra",
    Default = false,
    Callback = function(value)
        AutoKillEnabled = value
    end
})

-- Fast Attack logic
local UltraFastAttack = {}
local plr = game:GetService("Players").LocalPlayer
local rs = game:GetService("ReplicatedStorage")
local attackActive = true
local lastTick = 0

local function GetValidTargets()
    local targets = {}
    local char = plr.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return targets end
    local origin = char.HumanoidRootPart.Position
    local bodyParts = {"HumanoidRootPart", "Head", "UpperTorso", "LowerTorso"}

    for _, target in ipairs(workspace.Enemies:GetChildren()) do
        if target:FindFirstChild("Humanoid") and target.Humanoid.Health > 0 then
            local tRoot = target:FindFirstChild("HumanoidRootPart")
            if tRoot and (tRoot.Position - origin).Magnitude < 50 then
                table.insert(targets, {
                    model = target,
                    part = target:FindFirstChild(bodyParts[math.random(1, #bodyParts)]) or tRoot
                })
            end
        end
    end

    return targets
end

local function ExecuteAttack()
    if tick() - lastTick < 0.05 then return end
    lastTick = tick()

    local char = plr.Character
    if not char or not char:FindFirstChildOfClass("Tool") then return end

    local targets = GetValidTargets()
    if #targets == 0 then return end
    local modules = rs:FindFirstChild("Modules")
    if not modules then return end
    local net = modules:FindFirstChild("Net")
    if not net then return end

    local registerAttack = net:FindFirstChild("RE/RegisterAttack")
    local registerHit = net:FindFirstChild("RE/RegisterHit")
    if registerAttack then registerAttack:FireServer(0) end

    for _, target in ipairs(targets) do
        if registerHit then
            registerHit:FireServer(target.part, {{target.model, target.part}})
        end

        local combatScript = plr.PlayerScripts and plr.PlayerScripts:FindFirstChildOfClass("LocalScript")
        if combatScript and getsenv then
            local success, env = pcall(getsenv, combatScript)
            if success and env and env._G and env._G.SendHitsToServer then
                env._G.SendHitsToServer(target.part, {{target.model, target.part}})
            end
        end

        task.wait(0.01)
    end
end

game:GetService("RunService").Heartbeat:Connect(function()
    if attackActive then
        ExecuteAttack()
    end
end)

getgenv().ToggleFastAttack = function(state)
    attackActive = state ~= false
end

-- Hàm hỗ trợ
local function CheckGodChalice()
    local bp = plr.Backpack
    for _, item in pairs(bp:GetChildren()) do
        if item.Name:lower():find("god chalice") then
            return true
        end
    end
    return false
end

local function SummonRipIndra()
    for _, v in pairs(workspace:GetDescendants()) do
        if v:IsA("TouchTransmitter") and v.Parent and v.Parent:IsA("Part") and v.Parent.Name:find("Summon") then
            firetouchinterest(plr.Character.HumanoidRootPart, v.Parent, 0)
            firetouchinterest(plr.Character.HumanoidRootPart, v.Parent, 1)
        end
    end
end

local function TeleportToLowServer()
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/3zKr8T0HUB/tphub/main/LowServer.lua"))()
    end)
end

-- Auto loop
task.spawn(function()
    while true do
        if AutoKillEnabled then
            if CheckGodChalice() then
                SummonRipIndra()
                AutoKillEnabled = false
                break
            end

            local eliteFound = false
            for _, v in pairs(workspace.Enemies:GetChildren()) do
                if v.Name:find("Elite") and v:FindFirstChild("Humanoid") and v.Humanoid.Health > 0 then
                    eliteFound = true
                    repeat
                        pcall(function()
                            plr.Character.HumanoidRootPart.CFrame = v.HumanoidRootPart.CFrame * CFrame.new(0, 0, 3)
                        end)
                        task.wait(0.1)
                    until not v or not v:FindFirstChild("Humanoid") or v.Humanoid.Health <= 0 or not AutoKillEnabled
                end
            end

            if not eliteFound then
                task.wait(3)
                workspace:FindFirstChild("EliteHopConfig") or Instance.new("BoolValue", workspace).Name = "EliteHopConfig"
                TeleportToLowServer()
            end
        end
        task.wait(1)
    end
end)

SaveManager:SetLibrary(Fluent)
InterfaceManager:SetLibrary(Fluent)
SaveManager:BuildConfigSection(Tabs.Main)
SaveManager:LoadAutoloadConfig()
