-- Xác nhận game là Blox Fruits thay vì chỉ kiểm tra Sea 1
local validPlaceIds = {
    2753915549, -- Sea 1
    4442272183, -- Sea 2
    7449423635  -- Sea 3
}
repeat wait() until game:IsLoaded()

local isValidGame = false
for _, id in pairs(validPlaceIds) do
    if game.PlaceId == id then
        isValidGame = true
        break
    end
end

if not isValidGame then
    warn("Script này được tạo cho Blox Fruits!")
    return
end

-- Tạo ScreenGui để chứa các UI elements
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "GameUtilityGui"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

-- Tạo Frame chính để chứa tất cả các elements
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 180, 0, 130) -- Slightly wider to accommodate new buttons
MainFrame.Position = UDim2.new(0.98, -180, 0.05, 0)
MainFrame.BackgroundTransparency = 1
MainFrame.Parent = ScreenGui

-- Layout cho các nút
local function createHorizontalLayout()
    local UIListLayout = Instance.new("UIListLayout")
    UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
    UIListLayout.FillDirection = Enum.FillDirection.Horizontal
    UIListLayout.Padding = UDim.new(0, 5)
    UIListLayout.Parent = MainFrame
end

createHorizontalLayout()

-- Tạo Frame cho hàng đầu tiên (Reset và Job ID)
local FirstRowFrame = Instance.new("Frame")
FirstRowFrame.Name = "FirstRowFrame"
FirstRowFrame.Size = UDim2.new(1, 0, 0, 25)
FirstRowFrame.BackgroundTransparency = 1
FirstRowFrame.LayoutOrder = 1
FirstRowFrame.Parent = MainFrame

-- Tạo TextButton để làm nút Reset
local ResetButton = Instance.new("TextButton")
ResetButton.Name = "ResetButton"
ResetButton.Size = UDim2.new(0, 50, 0, 25)
ResetButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
ResetButton.Text = "Reset"
ResetButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ResetButton.Font = Enum.Font.SourceSansBold
ResetButton.TextSize = 12
ResetButton.BorderSizePixel = 0
ResetButton.AutoButtonColor = true
ResetButton.Parent = FirstRowFrame

-- Tạo TextBox để nhập JobID
local JobIDInput = Instance.new("TextBox")
JobIDInput.Name = "JobIDInput" 
JobIDInput.Size = UDim2.new(0, 80, 0, 25)
JobIDInput.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
JobIDInput.PlaceholderText = "Job ID..."
JobIDInput.Text = ""
JobIDInput.TextColor3 = Color3.fromRGB(0, 0, 0)
JobIDInput.Font = Enum.Font.SourceSans
JobIDInput.TextSize = 12
JobIDInput.ClearTextOnFocus = false
JobIDInput.Parent = FirstRowFrame

-- Tạo Frame cho hàng thứ hai (các nút chức năng)
local SecondRowFrame = Instance.new("Frame")
SecondRowFrame.Name = "SecondRowFrame"
SecondRowFrame.Size = UDim2.new(1, 0, 0, 25)
SecondRowFrame.BackgroundTransparency = 1
SecondRowFrame.LayoutOrder = 2
SecondRowFrame.Parent = MainFrame

-- Nút Join Server
local JoinButton = Instance.new("TextButton")
JoinButton.Name = "JoinButton"
JoinButton.Size = UDim2.new(0, 50, 0, 25)
JoinButton.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
JoinButton.Text = "Join"
JoinButton.TextColor3 = Color3.fromRGB(255, 255, 255)
JoinButton.Font = Enum.Font.SourceSansBold
JoinButton.TextSize = 12
JoinButton.BorderSizePixel = 0
JoinButton.AutoButtonColor = true
JoinButton.Parent = SecondRowFrame

-- Nút Clear Job ID
local ClearButton = Instance.new("TextButton")
ClearButton.Name = "ClearButton"
ClearButton.Size = UDim2.new(0, 50, 0, 25)
ClearButton.BackgroundColor3 = Color3.fromRGB(255, 165, 0)
ClearButton.Text = "Clear"
ClearButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ClearButton.Font = Enum.Font.SourceSansBold
ClearButton.TextSize = 12
ClearButton.BorderSizePixel = 0
ClearButton.AutoButtonColor = true
ClearButton.Parent = SecondRowFrame

-- Tạo Frame cho hàng thứ ba (các nút khác)
local ThirdRowFrame = Instance.new("Frame")
ThirdRowFrame.Name = "ThirdRowFrame"
ThirdRowFrame.Size = UDim2.new(1, 0, 0, 25)
ThirdRowFrame.BackgroundTransparency = 1
ThirdRowFrame.LayoutOrder = 3
ThirdRowFrame.Parent = MainFrame

-- Nút Copy Job ID
local CopyButton = Instance.new("TextButton")
CopyButton.Name = "CopyButton"
CopyButton.Size = UDim2.new(0, 60, 0, 25)
CopyButton.BackgroundColor3 = Color3.fromRGB(100, 100, 255)
CopyButton.Text = "Copy ID"
CopyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CopyButton.Font = Enum.Font.SourceSansBold
CopyButton.TextSize = 12
CopyButton.BorderSizePixel = 0
CopyButton.AutoButtonColor = true
CopyButton.Parent = ThirdRowFrame

-- Nút Paste Job ID
local PasteButton = Instance.new("TextButton")
PasteButton.Name = "PasteButton"
PasteButton.Size = UDim2.new(0, 60, 0, 25)
PasteButton.BackgroundColor3 = Color3.fromRGB(0, 200, 100)
PasteButton.Text = "Paste"
PasteButton.TextColor3 = Color3.fromRGB(255, 255, 255)
PasteButton.Font = Enum.Font.SourceSansBold
PasteButton.TextSize = 12
PasteButton.BorderSizePixel = 0
PasteButton.AutoButtonColor = true
PasteButton.Parent = ThirdRowFrame

-- Frame cuối cùng cho nút Less People
local FourthRowFrame = Instance.new("Frame")
FourthRowFrame.Name = "FourthRowFrame"
FourthRowFrame.Size = UDim2.new(1, 0, 0, 25)
FourthRowFrame.BackgroundTransparency = 1
FourthRowFrame.LayoutOrder = 4
FourthRowFrame.Parent = MainFrame

-- Nút Less People
local LessPeopleButton = Instance.new("TextButton")
LessPeopleButton.Name = "LessPeopleButton"
LessPeopleButton.Size = UDim2.new(1, 0, 0, 25)
LessPeopleButton.BackgroundColor3 = Color3.fromRGB(0, 255, 127)
LessPeopleButton.Text = "Join Less People"
LessPeopleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
LessPeopleButton.Font = Enum.Font.SourceSansBold
LessPeopleButton.TextSize = 12
LessPeopleButton.BorderSizePixel = 0
LessPeopleButton.AutoButtonColor = true
LessPeopleButton.Parent = FourthRowFrame

-- Thêm UICorner cho tất cả các elements
local function addCorners(instance)
    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 4)
    UICorner.Parent = instance
end

addCorners(ResetButton)
addCorners(JobIDInput)
addCorners(JoinButton)
addCorners(ClearButton)
addCorners(CopyButton)
addCorners(PasteButton)
addCorners(LessPeopleButton)

-- Thêm hiệu ứng hover cho các buttons
local function addHoverEffect(button, originalColor)
    button.MouseEnter:Connect(function()
        button.BackgroundColor3 = originalColor:Lerp(Color3.fromRGB(0, 0, 0), 0.2)
    end)
    
    button.MouseLeave:Connect(function()
        button.BackgroundColor3 = originalColor
    end)
end

addHoverEffect(ResetButton, Color3.fromRGB(255, 0, 0))
addHoverEffect(JoinButton, Color3.fromRGB(0, 170, 255))
addHoverEffect(ClearButton, Color3.fromRGB(255, 165, 0))
addHoverEffect(CopyButton, Color3.fromRGB(100, 100, 255))
addHoverEffect(PasteButton, Color3.fromRGB(0, 200, 100))
addHoverEffect(LessPeopleButton, Color3.fromRGB(0, 255, 127))

-- Xử lý sự kiện Reset Character
ResetButton.MouseButton1Click:Connect(function()
    local character = game.Players.LocalPlayer.Character
    if character then
        character:BreakJoints()
    end
end)

-- Xử lý sự kiện Copy Job ID
CopyButton.MouseButton1Click:Connect(function()
    setclipboard(game.JobId)
    -- Hiệu ứng phản hồi
    local originalText = CopyButton.Text
    CopyButton.Text = "Copied!"
    wait(1)
    CopyButton.Text = "Copy ID"
end)

-- Xử lý sự kiện Paste Job ID
PasteButton.MouseButton1Click:Connect(function()
    local success, result = pcall(function()
        return getclipboard()
    end)
    
    if success and result then
        JobIDInput.Text = result
    end
end)

-- Xử lý sự kiện Clear Job ID
ClearButton.MouseButton1Click:Connect(function()
    JobIDInput.Text = ""
end)

-- Xử lý sự kiện Join by JobID
JoinButton.MouseButton1Click:Connect(function()
    local jobId = JobIDInput.Text
    if jobId and jobId ~= "" then
        game:GetService("TeleportService"):TeleportToPlaceInstance(game.PlaceId, jobId)
    else
        JobIDInput.PlaceholderText = "Enter ID!"
        wait(2)
        JobIDInput.PlaceholderText = "Job ID..."
    end
end)

-- Xử lý sự kiện Less People - sửa để hoạt động với tất cả các sea
LessPeopleButton.MouseButton1Click:Connect(function()
    local TeleportService = game:GetService("TeleportService")
    local servers = {}
    
    local success, result = pcall(function()
        return game:GetService("HttpService"):JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/"..game.PlaceId.."/servers/Public?sortOrder=Asc&limit=100"))
    end)
    
    if success then
        for _, server in ipairs(result.data) do
            if server.playing < 4 then
                table.insert(servers, server)
            end
        end
        
        if #servers > 0 then
            local randomServer = servers[math.random(1, #servers)]
            TeleportService:TeleportToPlaceInstance(game.PlaceId, randomServer.id)
        else
            LessPeopleButton.Text = "No servers!"
            wait(2)
            LessPeopleButton.Text = "Join Less People"
        end
    end
end)

-- Xử lý khi người chơi thay đổi sea (teleport)
local function setupScript()
    -- Thiết lập lại GUI sau khi teleport
    if ScreenGui then
        ScreenGui.Enabled = true
    end
end

-- Thiết lập sự kiện teleport để script vẫn hoạt động sau khi chuyển sea
game:GetService("Players").LocalPlayer.OnTeleport:Connect(function(State)
    if State == Enum.TeleportState.Started then
        -- Lưu một script vào queue để chạy sau khi teleport hoàn tất
        syn = syn or {}
        if syn.queue_on_teleport then
            syn.queue_on_teleport(game:HttpGet("Đường dẫn đến script của bạn"))
            -- Lưu ý: Thay "Đường dẫn đến script của bạn" bằng URL thực tế nơi bạn lưu trữ script này
        end
    end
end)

-- Đảm bảo script hoạt động khi người chơi đã tải game
if game.Players.LocalPlayer.Character or game.Players.LocalPlayer.CharacterAdded:Wait() then
    setupScript()
end

game.Players.LocalPlayer.CharacterAdded:Connect(function()
    setupScript()
end)
