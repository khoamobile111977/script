-- Load Orion UI Library
local OrionLib = loadstring(game:HttpGet('https://raw.githubusercontent.com/khoamobile111977/script/refs/heads/main/orionui'))()

-- Create main window
local Window = OrionLib:MakeWindow({
    Name = "Boss Farm - Captain Elephant",
    HidePremium = false,
    SaveConfig = true,
    ConfigFolder = "ElephantFarm"
})

-- Variables
local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")
local farmEnabled = false
local fastAttackEnabled = false
local bringMobEnabled = false

-- Create main tab
local FarmTab = Window:MakeTab({
    Name = "Farm",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

-- Farm section
local FarmSection = FarmTab:AddSection({
    Name = "Farm Settings"
})

-- Function to equip Sharkman Karate
local function equipWeapon()
    local backpack = player.Backpack
    local weapon = backpack:FindFirstChild("Sharkman Karate")
    
    if weapon then
        character.Humanoid:EquipTool(weapon)
        return true
    else
        if character:FindFirstChild("Sharkman Karate") then
            return true
        end
        return false
    end
end

-- Tween function
local function tweenTo(destination, speed)
    if not speed then speed = 350 end
    
    local hrp = character:WaitForChild("HumanoidRootPart")
    local distance = (destination - hrp.Position).Magnitude
    local tweenService = game:GetService("TweenService")
    local info = TweenInfo.new(distance/speed, Enum.EasingStyle.Linear)
    
    local tween = tweenService:Create(hrp, info, {CFrame = CFrame.new(destination)})
    tween:Play()
    return tween
end

-- Fast Attack function
function AttackNoCoolDown()
    local character = player.Character
    if not character then return end
    
    local equippedWeapon = nil
    for _, item in ipairs(character:GetChildren()) do
        if item:IsA("Tool") then
            equippedWeapon = item
            break
        end
    end
    
    if not equippedWeapon then return end
    
    local function IsEntityAlive(entity)
        return entity and entity:FindFirstChild("Humanoid") and entity.Humanoid.Health > 0
    end
    
    local function GetEnemiesInRange(range)
        local enemies = game:GetService("Workspace").Enemies:GetChildren()
        local targets = {}
        local playerPos = character:GetPivot().Position
        
        for _, enemy in ipairs(enemies) do
            local primaryPart = enemy:FindFirstChild("HumanoidRootPart")
            if primaryPart and IsEntityAlive(enemy) and (primaryPart.Position - playerPos).Magnitude <= range then
                table.insert(targets, enemy)
            end
        end
        
        return targets
    end
    
    if equippedWeapon:FindFirstChild("LeftClickRemote") then
        local attackCount = 1  
        local enemiesInRange = GetEnemiesInRange(60)
        
        for _, enemy in ipairs(enemiesInRange) do
            local direction = (enemy.HumanoidRootPart.Position - character:GetPivot().Position).Unit
            pcall(function()
                equippedWeapon.LeftClickRemote:FireServer(direction, attackCount)
            end)
            attackCount = attackCount + 1
            if attackCount > 1000000000 then attackCount = 1 end
        end
    else
        local targets = {}
        local enemies = game:GetService("Workspace").Enemies:GetChildren()
        local playerPos = character:GetPivot().Position
        local mainTarget = nil
        
        for _, enemy in ipairs(enemies) do
            if not enemy:GetAttribute("IsBoat") and IsEntityAlive(enemy) then
                local head = enemy:FindFirstChild("Head")
                if head and (playerPos - head.Position).Magnitude <= 60 then
                    table.insert(targets, { enemy, head })
                    mainTarget = head
                end
            end
        end
        
        if not mainTarget then return end
        
        pcall(function()
            local storage = game:GetService("ReplicatedStorage")
            local attackEvent = storage:WaitForChild("Modules"):WaitForChild("Net"):WaitForChild("RE/RegisterAttack")
            local hitEvent = storage:WaitForChild("Modules"):WaitForChild("Net"):WaitForChild("RE/RegisterHit")
            
            if #targets > 0 then
                attackEvent:FireServer(0.000000001)
                hitEvent:FireServer(mainTarget, targets)
            else
                task.wait(0.000000001)
            end
        end)
    end
end

-- Bring Mob function
local function GetMobPosition(EnemiesName)
    local pos
    local count = 0
    
    for _, v in pairs(workspace.Enemies:GetChildren()) do
        if v.Name == EnemiesName then
            if not pos then
                pos = v.HumanoidRootPart.Position
            else
                pos = pos + v.HumanoidRootPart.Position
            end
            count = count + 1
        end
    end
    
    if count > 0 then
        pos = pos / count
        return pos
    end
    return nil
end

local function TweenObject(Object, Pos, Speed)
    if Speed == nil then Speed = 350 end
    local Distance = (Pos.Position - Object.Position).Magnitude
    local tweenService = game:GetService("TweenService")
    local info = TweenInfo.new(Distance/Speed, Enum.EasingStyle.Linear)
    local tween = tweenService:Create(Object, info, {CFrame = Pos})
    tween:Play()
    return tween
end

local function BringMob()
    local ememe = game.Workspace.Enemies:GetChildren()
    if #ememe > 0 then
        local totalpos = {}
        for _, v in pairs(ememe) do
            if not totalpos[v.Name] then
                local pos = GetMobPosition(v.Name)
                if pos then
                    totalpos[v.Name] = pos
                end
            end
        end
        
        for _, v in pairs(workspace.Enemies:GetChildren()) do
            if v:FindFirstChild("Humanoid") and v.Humanoid.Health > 0 and v:FindFirstChild("HumanoidRootPart") then
                if (v.HumanoidRootPart.Position - player.Character.HumanoidRootPart.Position).Magnitude <= 350 then
                    for k, f in pairs(totalpos) do
                        if k and v.Name == k and f then
                            local targetCFrame = CFrame.new(f.X, f.Y, f.Z)
                            local distance = (v.HumanoidRootPart.Position - targetCFrame.Position).Magnitude
                            
                            if distance > 3 and distance <= 280 then
                                TweenObject(v.HumanoidRootPart, targetCFrame, 300)
                                v.HumanoidRootPart.CanCollide = false
                                v.Humanoid.WalkSpeed = 0
                                v.Humanoid.JumpPower = 0
                                v.Humanoid:ChangeState(14)
                                sethiddenproperty(player, "SimulationRadius", math.huge)
                            end
                        end
                    end
                end
            end
        end
    end
end

-- Function to find the boss
local function findBoss()
    for _, v in pairs(workspace.Enemies:GetChildren()) do
        if v.Name == "Captain Elephant" and v:FindFirstChild("Humanoid") and v.Humanoid.Health > 0 then
            return v
        end
    end
    return nil
end

-- Main farm function
local function farmBoss()
    while farmEnabled do
        local boss = findBoss()
        
        if boss and boss:FindFirstChild("HumanoidRootPart") then
            local bossPosition = boss.HumanoidRootPart.Position
            
            -- Equip weapon if not equipped
            if not character:FindFirstChildOfClass("Tool") then
                if not equipWeapon() then
                    OrionLib:MakeNotification({
                        Name = "Weapon Not Found",
                        Content = "Sharkman Karate not found in backpack",
                        Image = "rbxassetid://4483345998",
                        Time = 5
                    })
                    wait(2)
                    continue
                end
            end
            
            -- Move to boss position
            local distance = (bossPosition - hrp.Position).Magnitude
            if distance > 10 then
                local tween = tweenTo(bossPosition, 200)
                local startTime = tick()
                
                -- Wait for tween to complete or timeout
                while tween and tick() - startTime < 5 and farmEnabled do
                    if (hrp.Position - bossPosition).Magnitude < 10 then
                        break
                    end
                    wait()
                end
            end
            
            -- Do fast attack if enabled
            if fastAttackEnabled then
                AttackNoCoolDown()
            end
            
            -- Bring mobs if enabled
            if bringMobEnabled then
                BringMob()
            end
        else
            -- If boss not found, wait a bit before looking again
            wait(1)
        end
        
        wait(0.1)
    end
end

-- Toggle for farm
FarmTab:AddToggle({
    Name = "Farm Captain Elephant",
    Default = false,
    Callback = function(Value)
        farmEnabled = Value
        
        if Value then
            OrionLib:MakeNotification({
                Name = "Farm Enabled",
                Content = "Starting to farm Captain Elephant",
                Image = "rbxassetid://4483345998",
                Time = 5
            })
            
            task.spawn(farmBoss)
        else
            OrionLib:MakeNotification({
                Name = "Farm Disabled",
                Content = "Stopped farming Captain Elephant",
                Image = "rbxassetid://4483345998",
                Time = 5
            })
        end
    end
})

-- Toggle for fast attack
FarmTab:AddToggle({
    Name = "Fast Attack",
    Default = true,
    Callback = function(Value)
        fastAttackEnabled = Value
        
        if Value then
            OrionLib:MakeNotification({
                Name = "Fast Attack",
                Content = "Fast Attack enabled",
                Image = "rbxassetid://4483345998",
                Time = 3
            })
        else
            OrionLib:MakeNotification({
                Name = "Fast Attack",
                Content = "Fast Attack disabled",
                Image = "rbxassetid://4483345998",
                Time = 3
            })
        end
    end
})

-- Toggle for bring mob
FarmTab:AddToggle({
    Name = "Bring Mob",
    Default = true,
    Callback = function(Value)
        bringMobEnabled = Value
        
        if Value then
            OrionLib:MakeNotification({
                Name = "Bring Mob",
                Content = "Bring Mob enabled",
                Image = "rbxassetid://4483345998",
                Time = 3
            })
        else
            OrionLib:MakeNotification({
                Name = "Bring Mob",
                Content = "Bring Mob disabled",
                Image = "rbxassetid://4483345998",
                Time = 3
            })
        end
    end
})

-- Add manual teleport button
FarmTab:AddButton({
    Name = "Teleport to Captain Elephant",
    Callback = function()
        local boss = findBoss()
        if boss and boss:FindFirstChild("HumanoidRootPart") then
            tweenTo(boss.HumanoidRootPart.Position, 200)
            OrionLib:MakeNotification({
                Name = "Teleporting",
                Content = "Teleporting to Captain Elephant",
                Image = "rbxassetid://4483345998",
                Time = 3
            })
        else
            OrionLib:MakeNotification({
                Name = "Boss Not Found",
                Content = "Captain Elephant not found in workspace",
                Image = "rbxassetid://4483345998",
                Time = 5
            })
        end
    end
})

-- Extra features tab
local SettingsTab = Window:MakeTab({
    Name = "Settings",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

-- Add teleport distance slider
SettingsTab:AddSlider({
    Name = "Attack Range",
    Min = 10,
    Max = 100,
    Default = 60,
    Color = Color3.fromRGB(255, 255, 255),
    Increment = 5,
    ValueName = "range",
    Callback = function(Value)
        attackRange = Value
    end    
})

-- Initialize
OrionLib:Init()

-- Clean up
player.CharacterAdded:Connect(function(newCharacter)
    character = newCharacter
    hrp = character:WaitForChild("HumanoidRootPart")
end)

-- Notification on load
OrionLib:MakeNotification({
    Name = "Script Loaded",
    Content = "Captain Elephant Farm is ready to use",
    Image = "rbxassetid://4483345998",
    Time = 5
})
